import{u as e,_ as a}from"./useTableData.js?v=1720690738171";import{au as l,_ as s,j as i,aj as t,K as o,B as n,G as r}from"./index.js?v=1720690738171";import{c}from"./file2.js?v=1720690738171";import{u as p}from"./useLoading.js?v=1720690738171";import{b as u}from"./_baseFindIndex.js?v=1720690738171";import{l as d,r as m,P as f,S as v,Z as x,V as h,q as k,_ as y,a3 as b,W as j,F as g,ag as w}from"./vue.js?v=1720690738171";import{_ as C}from"./Checkbox.js?v=1720690738171";import{_}from"./Ellipsis.js?v=1720690738171";import"./Skeleton.js?v=1720690738171";import"./DataTable.js?v=1720690738171";import"./Select.js?v=1720690738171";import"./Tag.js?v=1720690738171";import"./Empty.js?v=1720690738171";import"./omit.js?v=1720690738171";import"./pinia.js?v=1720690738171";const D={class:"flex flex-col h-full"},z={class:"flex-1 w-0 truncate"},E={class:"flex flex-1 overflow-hidden"},I={class:"w-160px py-12px overflow-auto"},P=["onClick"],S={class:"flex-1 ml-8px"},T={class:"flex-1","b-l":"1 solid #aaa"},F=d({__name:"index",props:{data:{}},setup(d,{expose:F}){const L=d,{path:K,checkedType:O,callback:R}=L.data,q=m([]),A=m([]),B=m(K||"/"),{table:G,columns:H}=e([{key:"checkbox",title:"",width:36,render:e=>O.includes(e.type)?f("div",{onClick:e=>{e.stopPropagation()}},[f(C,{checked:e.filename===A.value[0],onUpdateChecked:a=>{A.value=a?[e.filename]:[]}},null)]):""},{key:"filename",title:"File name",render:e=>f("div",{class:"flex"},[f("div",{class:"flex items-center flex-1 cursor-pointer",onClick:a=>{"dir"===e.type&&(a.preventDefault(),B.value+="".concat("/"===B.value?"":"/").concat(e.filename),Z(),a.stopPropagation())}},[f("div",null,["dir"===e.type?f(s,{name:"base-dir",size:"16"},null):"","file"===e.type?f(s,{name:"base-file",size:"16",color:"#666"},null):""]),f("div",{class:"ml-6px flex-1 w-0"},[f(_,null,{default:()=>[e.filename]})])])])},{key:"time",title:"Modification time",width:146},{key:"permission",title:"Permission",width:86},{key:"owner",title:"Owner",width:72}]),M=e=>({onClick:()=>{if(O.includes(e.type)){const i=(a=A.value,s=a=>a===e.filename,null!=a&&a.length?u(a,l(s),0):-1);A.value=-1!==i?[]:[e.filename]}var a,s},onDblclick:()=>{O.includes(e.type)&&(B.value+="".concat("/"===B.value?"":"/").concat(e.filename),Z())}}),U=()=>{const e=B.value.substring(0,B.value.lastIndexOf("/"));B.value=""===e?"/":e,Z()},{loading:V,setLoading:W}=p(),Z=async()=>{try{W(!0),G.data=[],A.value=[];const{message:e}=await c({path:B.value});if(i(e)){const a=[],l=t(e,"DIR",[]),s=t(e,"FILES",[]);l.forEach((e=>{a.push(J(e,"dir"))})),s.forEach((e=>{a.push(J(e,"file"))})),B.value=e.PATH,G.data=a,q.value=t(e,"DISK",[])}}finally{W(!1)}},J=(e,a)=>{const l=e.split(";"),s=l[0],i=o(l[2]),t=l[3],n=l[4];return{path:("/"!==B.value?B.value+"/":"")+s,filename:s,time:i,permission:t,owner:n,type:a}};return Z(),F({onConfirm:({hide:e})=>{const a=A.value.length>0?A.value[0]:"",l=("/"!==B.value?B.value+"/":"")+a,s=G.data.find((e=>e.filename===a));null==R||R(l,s),e()}}),(e,l)=>{const i=n,t=r,o=a;return v(),x("div",D,[f(t,{class:"items-center h-50px px-12px","b-b":"1 solid #aaa"},{default:h((()=>[f(i,{onClick:U},{default:h((()=>[k("Return")])),_:1}),y("div",z,"Current path: "+b(j(B)),1)])),_:1}),y("div",E,[y("div",I,[(v(!0),x(g,null,w(j(q),(e=>(v(),x("div",{key:e.path,class:"flex items-center p-8px pl-16px hover:bg-#ececec cursor-pointer transition-colors",onClick:a=>{return l=e.path,B.value=l,void Z();var l}},[f(s,{name:"file-disk",size:"18",color:"#666"}),y("div",S,b(e.path)+" "+b(e.size[2]?"(".concat(e.size[2],")"):""),1)],8,P)))),128))]),y("div",T,[f(o,{loading:j(V),"loading-num":10,bordered:!1,"virtual-scroll":!0,"max-height":456,data:j(G).data,columns:j(H),"row-props":M},null,8,["loading","data","columns"])])])])}}});export{F as default};
