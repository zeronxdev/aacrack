import{J as e,dn as a,h as t,j as s,k as i,m as o,B as l,q as n}from"./index.js?v=1720690738171";import{_ as p}from"./index112.js?v=1720690738171";import{_ as r}from"./index.vue_vue_type_script_setup_true_lang.js?v=1720690738171";import{a as c}from"./index.vue_vue_type_script_setup_true_lang2.js?v=1720690738171";import{_ as d}from"./index.vue_vue_type_script_setup_true_lang3.js?v=1720690738171";import{u,_ as m}from"./useTableData.js?v=1720690738171";import{u as _}from"./useLoading.js?v=1720690738171";import{b as k}from"./useTableColumns.js?v=1720690738171";import{b6 as b,b7 as g,b as y,b8 as f,b9 as h}from"./site2.js?v=1720690738171";import{l as w,r as j,f as v,t as x,S as C,Z as T,P as R,V as z,q as D,W as S,b as U,_ as B}from"./vue.js?v=1720690738171";import"./pinia.js?v=1720690738171";import"./Spin.js?v=1720690738171";import"./DataTable.js?v=1720690738171";import"./Checkbox.js?v=1720690738171";import"./Ellipsis.js?v=1720690738171";import"./Select.js?v=1720690738171";import"./Tag.js?v=1720690738171";import"./Empty.js?v=1720690738171";import"./omit.js?v=1720690738171";import"./Skeleton.js?v=1720690738171";import"./Progress.js?v=1720690738171";const L={class:"p-20px"},P={class:"w-600px h-400px bg-#282c34"},q=w({__name:"index",props:{data:{}},setup(w){const q=w,{row:E}=q.data,F=async()=>{await y({id:E.id}),X(),E.backup_count++},K=j(!1),A=j("");let J=null,V=!1;const W=()=>{A.value="",K.value=!0,Z()},Z=async(e=0)=>{V?J&&clearTimeout(J):J=window.setTimeout((async()=>{try{const{message:e}=await h();s(e)&&(A.value=e.result)}finally{Z(1e3)}}),e)},{keys:G,table:H,columns:I}=u([{type:"selection",width:40},{key:"name",title:"File name",ellipsis:{tooltip:{width:"trigger"}}},{key:"size",title:"File size",width:90,render:a=>e(a.size)},{key:"addtime",title:"Backup time",width:150},k({width:170,options:e=>[{label:"Restore",onClick:()=>{(e=>{t({title:"Restore backup file",content:"Are you sure to restore backup file?",onConfirm:async({hide:a})=>{a(),W(),V=!1,await f({file_name:e.name,site_id:E.id}),V=!0,K.value=!1}})})(e)}},{label:"Download",onClick:()=>{a(e.filename,e.name)}},{label:"Del",onClick:()=>{t({title:"Delete backup file",content:"The website backup is about to be deleted [".concat(e.name,"], do you want to continue?"),onConfirm:async({hide:a})=>{await b({id:e.id}),X(),E.backup_count--,a()}})}}]})]),M=[{key:"del",type:"confirm",label:"Please choose del",confirm:{title:"Batch delete",desc:"Please be cautious, The selected item will be [delete] after confirmation",columns:[I.value[1]],api:e=>b({id:e.id},!1),done:e=>{X(),E.backup_count-=e.length}}}],N=v({p:1,limit:10,search:E.id}),{loading:O,setLoading:Q}=_(),X=async()=>{try{Q(!0);const{message:e}=await g(x(N));s(e)?(H.data=i(e.data)?e.data:[],H.total=o(e.page)):(H.data=[],H.total=0)}finally{G.value=[],Q(!1)}};return X(),(e,a)=>{const t=l,s=m,i=d,o=c,u=r,_=p,k=n;return C(),T("div",L,[R(u,null,{toolsLeft:z((()=>[R(t,{type:"primary",onClick:F},{default:z((()=>[D("Backup")])),_:1})])),table:z((()=>[R(s,{"checked-row-keys":S(G),"onUpdate:checkedRowKeys":a[0]||(a[0]=e=>U(G)?G.value=e:null),loading:S(O),"loading-num":1,"max-height":340,data:S(H).data,columns:S(I)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:z((()=>[R(i,{"checked-row-keys":S(G),"onUpdate:checkedRowKeys":a[1]||(a[1]=e=>U(G)?G.value=e:null),data:S(H).data,options:M},null,8,["checked-row-keys","data"])])),pageRight:z((()=>[R(o,{page:S(N).p,"onUpdate:page":a[2]||(a[2]=e=>S(N).p=e),"page-size":S(N).limit,"onUpdate:pageSize":a[3]||(a[3]=e=>S(N).limit=e),"item-count":S(H).total,onRefresh:X},null,8,["page","page-size","item-count"])])),_:1}),R(k,{show:S(K),"onUpdate:show":a[4]||(a[4]=e=>U(K)?K.value=e:null),title:"Recovering backup","hide-close":!0},{default:z((()=>[B("div",P,[R(_,{log:S(A)},null,8,["log"])])])),_:1},8,["show"])])}}});export{q as default};
